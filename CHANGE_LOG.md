# 更新日志 / Change Log

## 2025-09-16 - Gemini流式传输支持与API修复

### 🚀 重大更新
- **完全修复Gemini模型连接问题**: 解决"新的 gemini model报错"问题
- **真正的流式传输支持**: 实现Gemini API的真正流式输出
- **智能流式解析**: 支持JSON数组流格式的实时解析

### 🔧 技术改进
- **自定义Gemini客户端**: 创建GeminiClient包装器，兼容OpenAI接口
- **流式端点优化**: 使用streamGenerateContent端点实现真正的流式传输
- **增量JSON解析**: 实现逐步解析JSON数组流的算法
- **API配置修复**: 修正GeminiProvider的base_url配置

### 📝 详细变更
- 修复providers.py中的GeminiProvider配置
- 实现真正的流式响应处理，支持逐块文本输出
- 添加JSON数组流解析器，处理Gemini特有的响应格式
- 保持向后兼容性，同步API仍正常工作

### 🧪 测试验证
- 同步API：✅ 正常工作
- 流式API：✅ 真正的实时输出
- 错误处理：✅ 完善的异常处理机制

---

## 2025-09-16 - 多语言作文批改系统升级

### 主要更新
- **多语言支持**: 新增英语和西班牙语作文批改功能
- **智能模型选择**: 根据服务器环境自动选择最优LLM模型
- **界面优化**: 调整布局，新增AI思考过程可视化面板
- **前端修复**: 修复JavaScript错误，完善用户体验

### 技术改进
- 添加Google Gemini 2.5 Flash Lite模型支持
- 实现基于hostname的智能LLM提供者选择
- 优化多语言批改提示词和响应解析
- 重构前端界面布局和交互逻辑

### 详细功能说明
- AI作文批改功能详情请参考: [AI_CORRECTION_GUIDE.md](AI_CORRECTION_GUIDE.md)

---

## 历史版本

### 2025-03-25 - 优化字幕质量
- 修正标点符号、大小写和说话人颜色区分

### 2025-03-24 - 异步字幕优化
- 实现异步字幕优化功能，提升用户体验

### 2025-03-23 - 移动端优化
- 移除24点游戏页面自动聚焦行为，优化移动端用户体验

### 2025-03-22 - 部署优化
- 修复Fabric部署超时问题

### 2025-03-21 - AI批改优化
- 全面优化AI批改流式响应处理