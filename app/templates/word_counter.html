<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>作文字数统计 - 超能力训练场</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 响应式设计 */
        @media (max-width: 768px) {
            .row {
                flex-direction: column;
            }
            
            .col-md-7, .col-md-5 {
                width: 100%;
                max-width: 100%;
                margin-bottom: 1rem;
            }
            
            #aiThinkingOutput {
                height: 150px !important;
                font-size: 0.8em !important;
            }
            
            .btn {
                margin-bottom: 0.5rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .card-body {
                padding: 1rem !important;
            }
        }
        
        /* AI思考输出样式 */
        #aiThinkingOutput {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }
        
        #aiThinkingOutput:hover {
            background-color: #e9ecef;
        }
        
        /* 折叠按钮样式 */
        .btn-link {
            border: none !important;
            box-shadow: none !important;
        }
        
        .btn-link:focus {
            box-shadow: none !important;
        }
        
        /* 手风琴样式 */
        .accordion-button {
            padding: 0.75rem 1rem;
            font-weight: 500;
        }
        
        .accordion-button:not(.collapsed) {
            background-color: #e7f3ff;
            border-color: #b3d9ff;
        }
        
        /* 滚动条样式 */
        #aiThinkingOutput::-webkit-scrollbar {
            width: 8px;
        }
        
        #aiThinkingOutput::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        #aiThinkingOutput::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        #aiThinkingOutput::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* 动画效果 */
        .spinner-border {
            width: 1.5rem;
            height: 1.5rem;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 正在输入行的光标效果 */
        .current-line::after {
            content: '▊';
            color: #007bff;
            animation: blink 1s infinite;
            margin-left: 2px;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* 移动设备优化 */
        @media (max-width: 576px) {
            .container {
                padding: 0 10px;
            }
            
            .btn {
                font-size: 0.875rem;
                padding: 0.5rem 0.75rem;
            }
            
            #aiThinkingOutput {
                height: 120px !important;
                font-size: 0.75em !important;
            }
            
            .card-header h5, .card-header h6 {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="mb-4">作文字数统计</h1>
        
        {% include '_navigation.html' %}

        <div class="row">
            <!-- 文本输入区域 -->
            <div class="col-md-7">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-edit me-2"></i>输入您的作文
                        </h5>
                    </div>
                    <div class="card-body">
                        <textarea 
                            id="essayText" 
                            class="form-control" 
                            rows="20" 
                            placeholder="请在此处输入您的作文内容..."
                            style="resize: vertical; min-height: 400px;"
                        ></textarea>
                        <div class="mt-3">
                            <button id="clearBtn" class="btn btn-outline-danger">
                                <i class="fas fa-trash me-1"></i>清空
                            </button>
                            <button id="analyzeBtn" class="btn btn-primary ms-2">
                                <i class="fas fa-calculator me-1"></i>统计字数
                            </button>
                            <button id="correctBtn" class="btn btn-success ms-2">
                                <i class="fas fa-edit me-1"></i>AI批改
                            </button>
                        </div>
                        
                        <!-- AI思考过程输出栏 -->
                        <div id="aiThinkingPanel" class="mt-3" style="display: none;">
                            <div class="card border-success">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">
                                        <button class="btn btn-link text-success p-0 text-decoration-none" 
                                                type="button" 
                                                data-bs-toggle="collapse" 
                                                data-bs-target="#aiThinkingContent" 
                                                aria-expanded="true" 
                                                aria-controls="aiThinkingContent"
                                                id="aiThinkingToggle">
                                            <i class="fas fa-robot me-2"></i>
                                            <span id="aiThinkingTitle">AI正在思考...</span>
                                            <i class="fas fa-chevron-down ms-2" id="aiThinkingChevron"></i>
                                        </button>
                                    </h6>
                                </div>
                                <div id="aiThinkingContent" class="collapse show">
                                    <div class="card-body p-3">
                                        <div id="aiThinkingOutput" 
                                             class="border rounded p-3 bg-light text-dark" 
                                             style="height: 200px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.9em; line-height: 1.4;">
                                            <div class="text-muted">等待AI开始批改...</div>
                                        </div>
                                        <div class="mt-2 d-flex justify-content-between align-items-center">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                实时显示AI思考过程
                                            </small>
                                            <button id="clearThinkingBtn" class="btn btn-sm btn-outline-secondary">
                                                <i class="fas fa-broom me-1"></i>清空输出
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右侧信息区域 -->
            <div class="col-md-5">
                <!-- 统计结果区域 -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-bar me-2"></i>统计结果
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="statsResults">
                            <div class="alert alert-info text-center">
                                <i class="fas fa-info-circle me-2"></i>
                                请输入文本后点击"统计字数"
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI批改结果区域 -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-robot me-2 text-success"></i>AI批改结果
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="correctionResults">
                            <div class="alert alert-info text-center">
                                <i class="fas fa-info-circle me-2"></i>
                                请输入作文后点击"AI批改"
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 统计说明 -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6 class="card-title mb-0">
                            <i class="fas fa-question-circle me-2"></i>功能说明
                        </h6>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled small text-muted">
                            <li><i class="fas fa-dot-circle me-2"></i>汉字：中文字符数量</li>
                            <li><i class="fas fa-dot-circle me-2"></i>标点：中英文标点符号</li>
                            <li><i class="fas fa-dot-circle me-2"></i>英文单词：连续字母组成的单词</li>
                            <li><i class="fas fa-dot-circle me-2"></i>总字符：包含所有字符</li>
                            <li><i class="fas fa-dot-circle me-2 text-success"></i>AI批改：检查病句、错别字、标点等</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const essayText = document.getElementById('essayText');
        const clearBtn = document.getElementById('clearBtn');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const correctBtn = document.getElementById('correctBtn');
        const statsResults = document.getElementById('statsResults');
        const correctionResults = document.getElementById('correctionResults');
        const aiThinkingPanel = document.getElementById('aiThinkingPanel');
        const aiThinkingOutput = document.getElementById('aiThinkingOutput');
        const aiThinkingTitle = document.getElementById('aiThinkingTitle');
        const aiThinkingChevron = document.getElementById('aiThinkingChevron');
        const clearThinkingBtn = document.getElementById('clearThinkingBtn');

        // 清空文本
        clearBtn.addEventListener('click', function() {
            essayText.value = '';
            showInitialMessage();
            showInitialCorrectionMessage();
            hideAiThinkingPanel();
        });

        // 清空AI思考输出
        clearThinkingBtn.addEventListener('click', function() {
            clearAiThinkingOutput();
        });

        // 监听折叠状态变化
        document.getElementById('aiThinkingContent').addEventListener('show.bs.collapse', function () {
            aiThinkingChevron.classList.remove('fa-chevron-down');
            aiThinkingChevron.classList.add('fa-chevron-up');
        });

        document.getElementById('aiThinkingContent').addEventListener('hide.bs.collapse', function () {
            aiThinkingChevron.classList.remove('fa-chevron-up');
            aiThinkingChevron.classList.add('fa-chevron-down');
        });

        // 分析文本
        analyzeBtn.addEventListener('click', function() {
            const text = essayText.value.trim();
            if (!text) {
                alert('请先输入文本内容');
                return;
            }
            analyzeText(text);
        });

        // AI批改作文
        correctBtn.addEventListener('click', function() {
            const text = essayText.value.trim();
            if (!text) {
                alert('请先输入作文内容');
                return;
            }
            if (text.length < 50) {
                alert('作文内容过短，请输入至少50个字符的作文');
                return;
            }
            correctEssay(text);
        });

        // 实时输入时自动分析（可选功能）
        let debounceTimer;
        essayText.addEventListener('input', function() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                const text = essayText.value.trim();
                if (text) {
                    analyzeText(text);
                } else {
                    showInitialMessage();
                }
            }, 500); // 500ms 延迟
        });

        function analyzeText(text) {
            // 显示加载状态
            statsResults.innerHTML = `
                <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">正在统计...</span>
                    </div>
                    <p class="mt-2 text-muted">正在分析文本...</p>
                </div>
            `;

            // 发送请求到后端API
            fetch('/api/analyze-text', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text: text })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displayResults(data.result);
                } else {
                    statsResults.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            分析失败：${data.error || '未知错误'}
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                statsResults.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        网络错误，请稍后重试
                    </div>
                `;
            });
        }

        function displayResults(result) {
            statsResults.innerHTML = `
                <div class="row g-3">
                    <div class="col-6">
                        <div class="card bg-primary text-white h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-font fa-2x mb-2"></i>
                                <h4 class="mb-1">${result.chinese_chars}</h4>
                                <small>汉字</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card bg-success text-white h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-spell-check fa-2x mb-2"></i>
                                <h4 class="mb-1">${result.english_words}</h4>
                                <small>英文单词</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card bg-warning text-white h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-quote-right fa-2x mb-2"></i>
                                <h4 class="mb-1">${result.punctuation}</h4>
                                <small>标点符号</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card bg-info text-white h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-list-ol fa-2x mb-2"></i>
                                <h4 class="mb-1">${result.total_chars}</h4>
                                <small>总字符</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-3">
                    <div class="alert alert-light">
                        <strong>分析完成！</strong> 
                        共检测到 <span class="badge bg-primary">${result.chinese_chars}</span> 个汉字，
                        <span class="badge bg-success">${result.english_words}</span> 个英文单词。
                    </div>
                </div>
            `;
        }

        function showInitialMessage() {
            statsResults.innerHTML = `
                <div class="alert alert-info text-center">
                    <i class="fas fa-info-circle me-2"></i>
                    请输入文本后点击"统计字数"
                </div>
            `;
        }

        function showInitialCorrectionMessage() {
            correctionResults.innerHTML = `
                <div class="alert alert-info text-center">
                    <i class="fas fa-info-circle me-2"></i>
                    请输入作文后点击"AI批改"
                </div>
            `;
        }

        function showAiThinkingPanel() {
            aiThinkingPanel.style.display = 'block';
            // 确保面板是展开的
            const collapseElement = document.getElementById('aiThinkingContent');
            if (!collapseElement.classList.contains('show')) {
                const bsCollapse = new bootstrap.Collapse(collapseElement, { show: true });
            }
        }

        function hideAiThinkingPanel() {
            aiThinkingPanel.style.display = 'none';
        }

        function clearAiThinkingOutput() {
            aiThinkingOutput.innerHTML = '<div class="text-muted">等待AI开始批改...</div>';
            // 移除所有current-line类
            const currentLines = aiThinkingOutput.querySelectorAll('.current-line');
            currentLines.forEach(line => line.classList.remove('current-line'));
        }

        function appendToAiThinking(content) {
            // 移除初始提示
            if (aiThinkingOutput.querySelector('.text-muted')) {
                aiThinkingOutput.innerHTML = '';
            }
            
            // 获取或创建当前行元素
            let currentLine = aiThinkingOutput.querySelector('.current-line');
            if (!currentLine) {
                currentLine = document.createElement('div');
                currentLine.className = 'mb-1 current-line';
                aiThinkingOutput.appendChild(currentLine);
            }
            
            // 处理内容
            const lines = content.split('\n');
            
            // 处理第一行（追加到当前行）
            if (lines.length > 0) {
                const firstLine = lines[0];
                currentLine.textContent += firstLine;
                
                // 为特殊内容添加样式
                if (firstLine.includes('📋 开始分析：')) {
                    currentLine.className = 'mb-1 text-primary fw-bold';
                } else if (firstLine.includes('完成') || firstLine.includes('成功')) {
                    currentLine.className = 'mb-1 text-success';
                } else if (firstLine.includes('错误') || firstLine.includes('失败')) {
                    currentLine.className = 'mb-1 text-danger';
                } else if (firstLine.includes('##')) {
                    currentLine.className = 'mb-1 text-info fw-bold';
                }
            }
            
            // 处理后续行（如果有换行符）
            for (let i = 1; i < lines.length; i++) {
                // 完成当前行
                currentLine.classList.remove('current-line');
                
                // 创建新行
                const newLine = document.createElement('div');
                newLine.className = 'mb-1 current-line';
                newLine.textContent = lines[i];
                
                // 为特殊内容添加样式
                if (lines[i].includes('📋 开始分析：')) {
                    newLine.className = 'mb-1 text-primary fw-bold current-line';
                } else if (lines[i].includes('完成') || lines[i].includes('成功')) {
                    newLine.className = 'mb-1 text-success current-line';
                } else if (lines[i].includes('错误') || lines[i].includes('失败')) {
                    newLine.className = 'mb-1 text-danger current-line';
                } else if (lines[i].includes('##')) {
                    newLine.className = 'mb-1 text-info fw-bold current-line';
                }
                
                aiThinkingOutput.appendChild(newLine);
                currentLine = newLine;
            }
            
            // 平滑滚动到底部
            aiThinkingOutput.scrollTo({
                top: aiThinkingOutput.scrollHeight,
                behavior: 'smooth'
            });
            
            // 如果内容太多，保持最新的100行
            while (aiThinkingOutput.children.length > 100) {
                aiThinkingOutput.removeChild(aiThinkingOutput.firstChild);
            }
        }

        // 添加打字机效果的实时输出
        function appendToAiThinkingWithTyping(content) {
            const lines = content.split('\n');
            let currentLineIndex = 0;
            
            function typeLine() {
                if (currentLineIndex >= lines.length) return;
                
                const line = lines[currentLineIndex];
                const lineElement = document.createElement('div');
                lineElement.className = 'mb-1 fade-in';
                lineElement.textContent = '';
                
                // 区分不同类型的消息
                if (line.includes('正在分析') || line.includes('开始')) {
                    lineElement.className += ' text-primary';
                } else if (line.includes('完成') || line.includes('成功')) {
                    lineElement.className += ' text-success';
                } else if (line.includes('错误') || line.includes('失败')) {
                    lineElement.className += ' text-danger';
                } else if (line.includes('思考') || line.includes('处理')) {
                    lineElement.className += ' text-info';
                }
                
                aiThinkingOutput.appendChild(lineElement);
                
                // 打字机效果
                let charIndex = 0;
                const typingInterval = setInterval(() => {
                    if (charIndex < line.length) {
                        lineElement.textContent += line[charIndex];
                        charIndex++;
                    } else {
                        clearInterval(typingInterval);
                        currentLineIndex++;
                        setTimeout(typeLine, 100); // 短暂停顿后继续下一行
                    }
                }, 50); // 50ms per character
                
                // 滚动到底部
                aiThinkingOutput.scrollTo({
                    top: aiThinkingOutput.scrollHeight,
                    behavior: 'smooth'
                });
            }
            
            // 移除初始提示
            if (aiThinkingOutput.querySelector('.text-muted')) {
                aiThinkingOutput.innerHTML = '';
            }
            
            typeLine();
        }

        function correctEssay(text) {
            // 显示加载状态
            correctionResults.innerHTML = `
                <div class="text-center">
                    <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">正在批改...</span>
                    </div>
                    <p class="mt-2 text-muted">AI正在批改作文，请稍候...</p>
                    <small class="text-muted">这可能需要10-30秒时间</small>
                </div>
            `;

            // 显示AI思考面板
            showAiThinkingPanel();
            clearAiThinkingOutput();
            aiThinkingTitle.textContent = 'AI正在思考...';

            // 使用fetch流式输出
            fetch('/api/correct-essay-stream', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text: text })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                function readStream() {
                    return reader.read().then(({ done, value }) => {
                        if (done) {
                            return;
                        }
                        
                        const chunk = decoder.decode(value, { stream: true });
                        const lines = chunk.split('\n');
                        
                        lines.forEach(line => {
                            if (line.startsWith('data: ')) {
                                try {
                                    const data = JSON.parse(line.substring(6));
                                    
                                    if (data.type === 'thinking') {
                                        // 显示AI思考过程
                                        appendToAiThinking(data.content);
                                    } else if (data.type === 'result') {
                                        // 显示最终结果
                                        aiThinkingTitle.textContent = 'AI批改完成';
                                        displayCorrectionResults(data.corrections);
                                        return;
                                    } else if (data.type === 'error') {
                                        // 显示错误
                                        aiThinkingTitle.textContent = 'AI批改失败';
                                        correctionResults.innerHTML = `
                                            <div class="alert alert-danger">
                                                <i class="fas fa-exclamation-triangle me-2"></i>
                                                批改失败：${data.error || '未知错误'}
                                            </div>
                                        `;
                                        return;
                                    }
                                } catch (e) {
                                    console.error('Error parsing JSON:', e);
                                }
                            }
                        });
                        
                        return readStream();
                    });
                }
                
                return readStream();
            })
            .catch(error => {
                console.error('Stream error:', error);
                aiThinkingTitle.textContent = 'AI批改失败';
                // 如果流式输出失败，尝试普通请求
                fallbackCorrectEssay(text);
            });
        }

        function fallbackCorrectEssay(text) {
            // 普通请求作为备用方案
            fetch('/api/correct-essay', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ text: text })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    aiThinkingTitle.textContent = 'AI批改完成';
                    displayCorrectionResults(data.corrections);
                    
                    // 显示AI原始响应
                    if (data.raw_response) {
                        appendToAiThinking('AI批改结果：\n' + data.raw_response);
                    }
                } else {
                    aiThinkingTitle.textContent = 'AI批改失败';
                    correctionResults.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            批改失败：${data.error || '未知错误'}
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                aiThinkingTitle.textContent = 'AI批改失败';
                correctionResults.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        网络错误，请稍后重试
                    </div>
                `;
            });
        }

        function displayCorrectionResults(corrections) {
            // 移除当前行的光标效果
            const currentLines = aiThinkingOutput.querySelectorAll('.current-line');
            currentLines.forEach(line => line.classList.remove('current-line'));
            
            if (!corrections || corrections.length === 0) {
                correctionResults.innerHTML = `
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>恭喜！</strong>您的作文暂未发现明显问题。
                    </div>
                `;
                return;
            }

            let html = '<div class="accordion" id="correctionAccordion">';
            
            corrections.forEach((section, index) => {
                const sectionId = `section${index}`;
                const iconMap = {
                    '病句修改': 'fas fa-exclamation-triangle text-warning',
                    '错别字修改': 'fas fa-spell-check text-danger',
                    '标点符号修改': 'fas fa-quote-right text-info',
                    '语言表达改进建议': 'fas fa-lightbulb text-primary',
                    '内容结构改进建议': 'fas fa-list-alt text-secondary'
                };
                
                const icon = iconMap[section.type] || 'fas fa-edit';
                const isFirst = index === 0;
                
                html += `
                    <div class="accordion-item">
                        <h6 class="accordion-header" id="heading${sectionId}">
                            <button class="accordion-button ${isFirst ? '' : 'collapsed'}" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#collapse${sectionId}" 
                                    aria-expanded="${isFirst}" aria-controls="collapse${sectionId}">
                                <i class="${icon} me-2"></i>
                                ${section.type} (${section.items.length}项)
                            </button>
                        </h6>
                        <div id="collapse${sectionId}" class="accordion-collapse collapse ${isFirst ? 'show' : ''}" 
                             aria-labelledby="heading${sectionId}" data-bs-parent="#correctionAccordion">
                            <div class="accordion-body">
                                <ul class="list-unstyled mb-0">
                `;
                
                section.items.forEach(item => {
                    html += `<li class="mb-2"><i class="fas fa-angle-right me-2 text-muted"></i>${item}</li>`;
                });
                
                html += `
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // 添加总结信息
            const totalIssues = corrections.reduce((sum, section) => sum + section.items.length, 0);
            html = `
                <div class="alert alert-warning mb-3">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>批改完成！</strong> 发现 <span class="badge bg-warning text-dark">${totalIssues}</span> 处需要改进的地方。
                </div>
            ` + html;
            
            correctionResults.innerHTML = html;
        }
    </script>
</body>
</html> 