# AI作文批改功能使用指南

## 功能概述

AI作文批改功能支持多语言作文批改，智能选择最优模型为您提供专业的批改建议。该功能具有以下特点：

- 🌍 **多语言支持**：支持中文、英语、西班牙语三种语言作文批改
- 🤖 **智能模型选择**：根据服务器环境自动选择最优LLM模型
- 🔍 **智能检测**：自动识别病句、错别字、标点符号错误
- 📝 **详细建议**：提供语言表达和内容结构的改进建议
- 🔄 **实时反馈**：显示AI的思考过程，让您了解批改的进展
- 📱 **响应式设计**：支持PC端和移动端使用
- 🎯 **防抄袭设计**：只提供修改建议，不直接给出修改后的原文

## 使用方法

### 1. 访问页面
访问 `/word-counter` 页面，即可看到作文字数统计和AI批改功能。

### 2. 选择语言
在语言选择器中选择作文的语言：
- **中文**：按字符数统计，支持1-9年级要求
- **English**：按单词数统计，支持60-1000词范围
- **Español**：按单词数统计，适合西班牙语学习

### 3. 输入作文
在左侧的文本框中输入您的作文内容（至少50个字符）。

### 4. 选择要求
根据作文要求选择：
- **字数/词数要求**：系统根据语言自动调整计数单位
- **年级水平**：影响批改标准和建议深度

### 5. 开始批改
点击"AI批改"按钮，系统将：
- 显示AI思考过程面板
- 实时展示AI的分析进展
- 最终显示详细的批改结果

### 6. 查看结果
批改结果按以下类别展示：
- 🔶 **病句修改**：语法错误、表达不当
- 🔴 **错别字修改**：错字、别字纠正
- 🔵 **标点符号修改**：标点使用错误
- 💡 **语言表达改进建议**：提升表达质量
- 📋 **内容结构改进建议**：优化文章结构

**注意**：所有语言的批改说明均使用中文，便于中国学生理解学习。

## 界面功能

### AI思考过程面板
- **可折叠设计**：点击标题栏可收起/展开面板
- **实时输出**：显示AI的思考过程和分析进展
- **滚动显示**：自动滚动到最新内容
- **清空功能**：点击"清空输出"可清除历史记录

### 批改结果展示
- **手风琴式展示**：分类显示不同类型的问题
- **统计信息**：显示发现的问题总数
- **详细建议**：每个问题都有具体的修改建议

## 多语言功能详解

### 语言支持
- **中文作文批改**
  - 计数单位：字符数（汉字、标点、英文字符）
  - 年级支持：一年级到初三
  - 字数要求：300-1500字左右
  - 专项检查：错别字、病句、标点符号

- **英语作文批改**
  - 计数单位：单词数（连续字母组成）
  - 词数要求：60-1000词
  - 专项检查：语法错误、拼写错误、标点符号
  - 说明语言：中文解释，便于学习

- **西班牙语作文批改**
  - 计数单位：单词数（连续字母组成）
  - 词数要求：60-1000词
  - 专项检查：语法错误、拼写错误、标点符号
  - 说明语言：中文解释，便于学习

### 智能模型选择
系统根据服务器环境自动选择最优LLM模型：

**maru服务器（内网环境）**
- 模型：阿里云 DeepSeek-R1
- 原因：无VPN环境，使用国内模型保证访问稳定性
- 特点：深度思维模型，批改质量高

**其他环境（有外网访问）**
- 首选：Google Gemini 2.5 Flash Lite
- 备选：阿里云 DeepSeek-R1（配置失败时自动回退）
- 特点：轻量快速，多语言支持优秀

### 统计功能升级
- **中文模式**：显示汉字数、标点符号数、英文单词数、总字符数
- **英语/西语模式**：显示主要单词数、标点符号数、总字符数、语言标识
- **实时统计**：切换语言后自动重新统计

## 技术特点

### 流式输出
- 使用Fetch Stream API实现实时数据传输
- 支持断线重连和错误处理
- 兼容现代浏览器

### 响应式设计
- 移动端优化布局
- 自适应屏幕尺寸
- 触摸友好的交互设计

### 用户体验
- 动画效果增强视觉体验
- 加载状态提示
- 错误处理和重试机制

## 注意事项

1. **网络要求**：需要稳定的网络连接，AI批改可能需要10-30秒
2. **内容要求**：作文内容至少50个字符
3. **API配置**：需要正确配置阿里云API密钥
4. **浏览器兼容**：建议使用Chrome、Firefox、Safari等现代浏览器

## 故障排除

### 常见问题

**Q: AI批改按钮点击后没有反应？**
A: 检查网络连接，确保作文内容至少50个字符，刷新页面重试。

**Q: 思考过程面板一直显示"等待AI开始批改"？**
A: 可能是API配置问题，检查阿里云API密钥是否正确配置。

**Q: 批改过程中断了？**
A: 系统会自动降级到普通API，或刷新页面重新尝试。

**Q: 移动端显示不正常？**
A: 确保使用现代浏览器，并允许JavaScript运行。

### 技术支持
如果遇到问题，请查看：
1. 浏览器控制台错误信息
2. 网络连接状态
3. API配置是否正确

## 测试

运行测试脚本验证功能：
```bash
python test_ai_correction.py
```

测试包括：
- 普通API功能测试
- 流式API功能测试
- 错误处理测试

## 更新日志

### v2.0.0 (2025-09-16) - 多语言支持重大升级
- 🌍 **多语言作文批改**
  - 新增英语和西班牙语作文批改支持
  - 语言自适应计数单位（中文：字符，英语/西语：单词）
  - 英语作文词数限制60-1000词
  - 所有语言批改均使用中文说明

- 🤖 **智能模型选择**
  - 基于hostname的环境检测
  - maru服务器：阿里云DeepSeek-R1模型
  - 其他环境：Google Gemini 2.5 Flash Lite模型
  - 自动降级和错误恢复机制

- 🎨 **界面重构**
  - 新增语言选择器
  - 动态字数/词数要求选项
  - 重新布局：AI批改结果左栏，统计信息右栏
  - 新增AI思考过程可视化面板

- 🔧 **技术改进**
  - 优化批改提示词，添加格式示例
  - 增强响应解析器，支持中英文混合标题
  - 修复前端JavaScript错误
  - 改进文本统计算法

### v1.1.0 (流式响应优化)
- ✅ **全面优化流式响应处理**
  - 智能设备检测和自适应模式选择
  - 动态超时设置（移动设备3分钟，桌面2分钟）
  - 增强的重试机制（最多3次，指数退避）
  - 客户端和服务器端心跳监控
  - 网络状态检测和用户反馈
- ✅ **错误处理升级**
  - 详细的错误分类和建议
  - 优雅的连接中断处理
  - 一键重试功能
  - 高级用户强制流式模式选项
- ✅ **移动端优化**
  - iPad Safari兼容性修复
  - Android设备流式支持改进
  - 网络状况自适应
  - 触屏友好的交互设计

### v1.0.0 (基础版本)
- ✅ 基础AI批改功能
- ✅ 实时思考过程显示
- ✅ 响应式设计
- ✅ 流式输出支持
- ✅ 错误处理和重试机制 